<div class="property-details-container">
  <div class="container py-4">
    <!-- Property navigation links -->
    <div class="navigation-links">
      <a routerLink="/" class="back-link">
        <i class="fas fa-arrow-left"></i> Back to Homepage
      </a>
      <div class="breadcrumbs">
        <span>Home</span> / 
        <span>Properties</span> / 
        <span class="current">Property #{{ propertyId }}</span>
      </div>
    </div>

    <!-- Loading state -->
    <div class="loading-container" *ngIf="isLoading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Loading property details...</p>
    </div>

    <!-- Error state -->
    <div class="alert alert-danger" *ngIf="errorMessage">
      {{ errorMessage }}
      <button class="btn btn-sm btn-outline-danger ms-3" (click)="retryLoading()">Try Again</button>
    </div>

    <!-- Property content -->
    <div class="property-content" *ngIf="property && !isLoading">
      <!-- Property header -->
      <div class="property-header">
        <div class="property-title">
          <h1>{{ property.title || 'Beautiful Property' }}</h1>
          <p class="property-address">
            <i class="fas fa-map-marker-alt"></i> {{ property.location.address || 'Address not available' }}
          </p>
          <!-- Added Owner Information -->
          <div class="property-owner">
            <span class="owner-label">Listed by:</span>
            <div class="owner-info">
              <img [src]="property.agent.photo" alt="Agent photo" class="owner-photo">
              <div class="owner-details">
                <span class="owner-name">{{property.agent.name}}</span>
                <span class="owner-title">{{property.agent.title || 'Real Estate Agent'}}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="property-price">
          <h2>{{ formatPrice(property.price || 0) }}</h2>
          <div class="property-tags">
            <span class="tag" *ngFor="let tag of property.tags">{{ tag }}</span>
          </div>
        </div>
      </div>

      <!-- Image gallery -->
      <div class="property-gallery">
        <div class="main-image-container">
          <button class="gallery-nav prev" (click)="prevImage()">&#10094;</button>
          <img [src]="property.images[activeImageIndex]" alt="Property image" class="main-image">
          <button class="gallery-nav next" (click)="nextImage()">&#10095;</button>
        </div>
        <div class="thumbnail-container">
          <div *ngFor="let image of property.images; let i = index" 
               class="thumbnail" 
               [ngClass]="{'active': i === activeImageIndex}"
               (click)="setActiveImage(i)">
            <img [src]="image" alt="Property thumbnail">
          </div>
        </div>
      </div>

      <!-- Property details -->
      <div class="property-details-grid">
        <div class="property-info">
          <!-- Enhanced Features Section with Headings -->
          <div class="property-features-section">
            <h2 class="section-title">Facts & Features</h2>
            
            <div class="features-category">
              <h3 class="category-title"><i class="fas fa-home"></i> Interior</h3>
              
              <div class="property-features">
                <div class="feature">
                  <i class="fas fa-bed"></i>
                  <div class="feature-text">
                    <span class="feature-value">{{property.features.bedrooms}}</span>
                    <span class="feature-label">Bedrooms</span>
                  </div>
                </div>
                <div class="feature">
                  <i class="fas fa-bath"></i>
                  <div class="feature-text">
                    <span class="feature-value">{{property.features.bathrooms}}</span>
                    <span class="feature-label">Bathrooms</span>
                  </div>
                </div>
                <div class="feature">
                  <i class="fas fa-ruler-combined"></i>
                  <div class="feature-text">
                    <span class="feature-value">{{property.features.area}}</span>
                    <span class="feature-label">Sq Ft</span>
                  </div>
                </div>
                <div class="feature">
                  <i class="fas fa-calendar-alt"></i>
                  <div class="feature-text">
                    <span class="feature-value">{{property.features.yearBuilt}}</span>
                    <span class="feature-label">Year Built</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="property-description">
            <h3>Description</h3>
            <p>{{property.description}}</p>
          </div>

        </div>

        <!-- Agent Info - Redesigned -->
        <div class="agent-info">
          <div class="agent-card">
            <div class="agent-info-header">
              <h3 class="section-title"><i class="fas fa-user-tie"></i> Property Agent</h3>
            </div>
            <div class="agent-content">
              <div class="agent-image">
                <img [src]="property.agent.photo" alt="Agent photo">
              </div>
              <div class="agent-details">
                <h3 class="agent-name">{{property.agent.name}}</h3>
                <p class="agent-title">{{property.agent.title || 'Real Estate Agent'}}</p>
                <div class="agent-contact-info">
                  <div class="contact-item">
                    <i class="fas fa-phone"></i>
                    <span>{{property.agent.phone}}</span>
                  </div>
                  <div class="contact-item">
                    <i class="fas fa-envelope"></i>
                    <span>{{property.agent.email}}</span>
                  </div>
                  <div class="contact-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Licensed Real Estate Agent</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Action buttons -->
          <div class="agent-action-buttons">
            <button class="action-button contact-button" (click)="toggleContactForm()">
              <i class="fas fa-envelope"></i> Contact Agent
            </button>
            <button class="action-button schedule-button" (click)="toggleScheduleForm()">
              <i class="fas fa-calendar-check"></i> Schedule a Viewing
            </button>
          </div>

          <!-- Contact form -->
          <div class="contact-form-container" *ngIf="showContactForm">
            <div class="form-header">
              <h3>Contact Agent</h3>
              <button class="close-form-btn" (click)="toggleContactForm()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="quick-contact-options">
              <a href="tel:{{property.agent.phone}}" class="quick-contact-btn phone-btn">
                <i class="fas fa-phone"></i> Call Now
              </a>
              <a href="https://zalo.me/{{property.agent.phone}}" target="_blank" class="quick-contact-btn zalo-btn">
                <i class="fas fa-comment"></i> Zalo
              </a>
              <a href="mailto:{{property.agent.email}}" class="quick-contact-btn email-btn">
                <i class="fas fa-envelope"></i> Email
              </a>
            </div>
            <div class="contact-form-divider">
              <span>Or send a message</span>
            </div>
            <form [formGroup]="contactForm" (ngSubmit)="submitContactForm()" class="enhanced-contact-form">
              <div class="form-floating mb-3">
                <input type="text" id="name" formControlName="name" class="form-control" 
                      placeholder="Full Name"
                      [ngClass]="{'is-invalid': isFieldInvalid(contactForm, 'name')}">
                <label for="name"><i class="fas fa-user"></i> Full Name</label>
                <div *ngIf="formSubmitted && contactForm.get('name')?.invalid" class="invalid-feedback">
                  Please enter your name
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-floating mb-3 col">
                  <input type="email" id="email" formControlName="email" class="form-control" 
                        placeholder="Email"
                        [ngClass]="{'is-invalid': isFieldInvalid(contactForm, 'email')}">
                  <label for="email"><i class="fas fa-envelope"></i> Email</label>
                  <div *ngIf="formSubmitted && contactForm.get('email')?.invalid" class="invalid-feedback">
                    Please enter a valid email
                  </div>
                </div>
                
                <div class="form-floating mb-3 col">
                  <input type="tel" id="phone" formControlName="phone" class="form-control"
                        placeholder="Phone Number" 
                        [ngClass]="{'is-invalid': isFieldInvalid(contactForm, 'phone')}">
                  <label for="phone"><i class="fas fa-phone"></i> Phone Number</label>
                  <div *ngIf="formSubmitted && contactForm.get('phone')?.invalid" class="invalid-feedback">
                    Please enter your phone number
                  </div>
                </div>
              </div>
              
              <div class="form-floating mb-3">
                <textarea id="message" formControlName="message" class="form-control"
                          placeholder="Message" rows="5"
                          [ngClass]="{'is-invalid': isFieldInvalid(contactForm, 'message')}"></textarea>
                <label for="message"><i class="fas fa-comment"></i> Message</label>
                <div *ngIf="formSubmitted && contactForm.get('message')?.invalid" class="invalid-feedback">
                  Please enter your message
                </div>
              </div>
              
              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="newsletter" formControlName="newsletter">
                <label class="form-check-label" for="newsletter">
                  I want to receive updates about similar properties
                </label>
              </div>
              
              <button type="submit" class="primary-button w-100">
                <i class="fas fa-paper-plane"></i> Send Message
              </button>
              
              <div class="contact-privacy-note">
                Your information is protected according to our <a href="/privacy" target="_blank">privacy policy</a>
              </div>
            </form>
          </div>

          <!-- Schedule viewing -->
          <div class="schedule-viewing" *ngIf="showScheduleForm">
            <div class="form-header">
              <h3>Schedule a Viewing</h3>
              <button class="close-form-btn" (click)="toggleScheduleForm()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="schedule-intro">
              <p><i class="fas fa-calendar-check"></i> Schedule a free, no-obligation property viewing</p>
            </div>
            
            <form [formGroup]="scheduleForm" (ngSubmit)="submitScheduleForm()">
              <div class="form-floating mb-3">
                <input type="date" id="date" formControlName="date" class="form-control"
                       [ngClass]="{'is-invalid': isFieldInvalid(scheduleForm, 'date')}">
                <label for="date"><i class="fas fa-calendar"></i> Viewing Date</label>
                <div *ngIf="scheduleSubmitted && scheduleForm.get('date')?.invalid" class="invalid-feedback">
                  Please select a date
                </div>
              </div>
              
              <div class="form-floating mb-3">
                <input type="time" id="time" formControlName="time" class="form-control"
                       [ngClass]="{'is-invalid': isFieldInvalid(scheduleForm, 'time')}">
                <label for="time"><i class="fas fa-clock"></i> Time</label>
                <div *ngIf="scheduleSubmitted && scheduleForm.get('time')?.invalid" class="invalid-feedback">
                  Please select a time
                </div>
              </div>

              <div class="form-floating mb-3">
                <textarea id="notes" formControlName="notes" class="form-control" placeholder="Notes"></textarea>
                <label for="notes"><i class="fas fa-sticky-note"></i> Additional Notes (optional)</label>
              </div>
              
              <div class="available-times">
                <p>Available time slots today:</p>
                <div class="time-slots">
                  <button type="button" class="time-slot" (click)="selectTimeSlot('09:00')">9:00</button>
                  <button type="button" class="time-slot" (click)="selectTimeSlot('10:30')">10:30</button>
                  <button type="button" class="time-slot" (click)="selectTimeSlot('13:00')">13:00</button>
                  <button type="button" class="time-slot" (click)="selectTimeSlot('15:30')">15:30</button>
                  <button type="button" class="time-slot" (click)="selectTimeSlot('17:00')">17:00</button>
                </div>
              </div>
              
              <button type="submit" class="secondary-button">
                <i class="fas fa-calendar-check"></i> Schedule Viewing
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Property Reviews Section -->
      <div class="reviews-section">
        <app-property-reviews [propertyId]="propertyId || ''"></app-property-reviews>
      </div>

      <!-- Similar properties -->
      <div class="similar-properties-section">
        <h3>Similar Properties</h3>
        <div class="similar-properties-grid">
          <div class="property-card" *ngFor="let prop of similarProperties">
            <div class="property-card-image">
              <img [src]="prop.images[0]" alt="Property image">
              <div class="property-card-price">{{prop.title}}</div>
            </div>
            <div class="property-card-content">
              <h4>{{prop.title}}</h4>
              <div class="property-card-features">
                <span><i class="fas fa-bed"></i> {{prop.features.bedrooms}} beds</span>
                <span><i class="fas fa-bath"></i> {{prop.features.bathrooms}} baths</span>
                <span><i class="fas fa-ruler-combined"></i> {{prop.features.area}} sqft</span>
              </div>
              <a [routerLink]="['/property', prop.id]" class="view-property-link">View Details</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 